<!doctypehtml><html lang="en"><meta charset="UTF-8"><title>Yaksha Programming Language</title><link rel="apple-touch-icon"sizes="180x180"href="/apple-touch-icon.png"><link rel="icon"type="image/png"sizes="32x32"href="/favicon-32x32.png"><link rel="icon"type="image/png"sizes="16x16"href="/favicon-16x16.png"><link rel="manifest"href="/site.webmanifest"><link rel="mask-icon"href="/safari-pinned-tab.svg"color="#5bbad5"><meta name="msapplication-TileColor"content="#ffc7fd"><meta name="theme-color"content="#ffffff"><meta name="description"content="Yaksha Programming Language"><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="preconnect"href="https://fonts.googleapis.com"><link rel="preconnect"href="https://fonts.gstatic.com"crossorigin><link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&family=Source+Code+Pro:wght@400;600;900&family=Ubuntu&display=swap"rel="stylesheet"><link rel="stylesheet"href="/assets/normalize.min.css"><link rel="stylesheet"href="/assets/medium-font.min.css"id="font-size-link"><link rel="stylesheet"href="/assets/style.light.min.css"id="theme-link"><link rel="stylesheet"href="/assets/printing.min.css"media="print"><div class="container"><div class="table-of-contents"><img id="yaksha-logo"alt="Yaksha Programming Language"src="images/yk-banner.png"style="max-width:100%;display:none"><p id="pages-text-toc">Pages<nav><a href="/">Home</a> <a href="/library-docs.html">Lib</a> <a href="/documentation.html">Docs</a> <a href="/tutorials.html">Tutorials</a> <a href="/demos.html">Demos</a> <a href="/yama.html">YAMA</a> <a href="/blog.html">(B)log</a></nav><button id="btn-toggle"class="button action-button"><svg xmlns="http://www.w3.org/2000/svg"width="32"height="32"fill="currentColor"class="bi bi-brightness-high"viewBox="0 0 16 16"><path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/></svg></button> <button id="btn-small-font"class="button action-button"><svg xmlns="http://www.w3.org/2000/svg"width="32"height="32"fill="currentColor"class="bi bi-fonts"viewBox="0 0 32 32"><path d="M12.258 3h-8.51l-.083 2.46h.479c.26-1.544.758-1.783 2.693-1.845l.424-.013v7.827c0 .663-.144.82-1.3.923v.52h4.082v-.52c-1.162-.103-1.306-.26-1.306-.923V3.602l.431.013c1.934.062 2.434.301 2.693 1.846h.479L12.258 3z"/></svg></button> <button id="btn-medium-font"class="button action-button"><svg xmlns="http://www.w3.org/2000/svg"width="32"height="32"fill="currentColor"class="bi bi-fonts"viewBox="0 0 24 24"><path d="M12.258 3h-8.51l-.083 2.46h.479c.26-1.544.758-1.783 2.693-1.845l.424-.013v7.827c0 .663-.144.82-1.3.923v.52h4.082v-.52c-1.162-.103-1.306-.26-1.306-.923V3.602l.431.013c1.934.062 2.434.301 2.693 1.846h.479L12.258 3z"/></svg></button> <button id="btn-large-font"class="button action-button"><svg xmlns="http://www.w3.org/2000/svg"width="32"height="32"fill="currentColor"class="bi bi-fonts"viewBox="0 0 16 16"><path d="M12.258 3h-8.51l-.083 2.46h.479c.26-1.544.758-1.783 2.693-1.845l.424-.013v7.827c0 .663-.144.82-1.3.923v.52h4.082v-.52c-1.162-.103-1.306-.26-1.306-.923V3.602l.431.013c1.934.062 2.434.301 2.693 1.846h.479L12.258 3z"/></svg></button><div>&nbsp;</div><div class="real-toc"><div>&nbsp;</div><p>Table of Contents<div class="toc-item"><a href="#yama-0001-exposing-c-enums-defines-consts">YAMA 0001 - Exposing C enums/#defines/consts</a></div><div class="toc-item"><a href="#yama-0002-adding-support-for-stack-allocated-structs">YAMA 0002 - Adding support for stack allocated structs</a></div><div class="toc-item"><a href="#yama-0003-for-loop-loop">YAMA 0003 - For loop / loop</a></div><div class="toc-item"><a href="#yama-0004-iterators">YAMA 0004 - Iterators</a></div><div class="toc-item"><a href="#yama-0005-dsl-macros-for-yaksha">YAMA 0005 - DSL macros for Yaksha</a></div><div class="toc-item"><a href="#yama-0006-c-2-c-compiler-intermediate-c99-to-c99-optimizing-compiler">YAMA 0006 - C 2 C Compiler - Intermediate C99 to C99 optimizing compiler</a></div><div class="toc-item"><a href="#yama-0007-additional-features-for-structs">YAMA 0007 - Additional features for structs</a></div><div class="toc-item"><a href="#yama-0008-sugar-methods">YAMA 0008 - Sugar methods</a></div><div class="toc-item"><a href="#yama-0009-strings-revisited">YAMA 0009 - Strings revisited</a></div><div class="toc-item"><a href="#yama-0010-numbers-auto-casting-when-widening">YAMA 0010 - Numbers auto casting when widening</a></div></div></div><div class="boxes"><hr><div class="box"><div class="content"></div><div class="note"></div></div><div class="box"><div class="content"><h2 id="yama-0001-exposing-c-enums-defines-consts">YAMA 0001 - Exposing C enums/#defines/consts</h2><span class="timestamp">Created 2023-07-30, Last Updated 2023-07-30</span><ul><li>Author(s): Bhathiya Perera</ul><ul><li>Status : ✅</ul><h3 id="problem">Problem</h3><p>In C we can define enums such as below.<div class="highlight"><pre><span></span><span class="c1">// Simple</span>
<span class="k">enum</span><span class="w"> </span><span class="n">something1</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">SOMETHING1</span><span class="p">,</span>
<span class="w">  </span><span class="n">ANOTHER1</span>
<span class="p">};</span>

<span class="c1">// Separate typedef</span>
<span class="k">enum</span><span class="w"> </span><span class="n">something2</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">SOMETHING2</span><span class="p">,</span>
<span class="w">  </span><span class="n">ANOTHER2</span>
<span class="p">};</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">something2</span><span class="w"> </span><span class="n">something2_t</span><span class="p">;</span>

<span class="c1">// Combined</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">enum</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">SOMETHING3</span><span class="p">,</span>
<span class="w">  </span><span class="n">ANOTHER3</span>
<span class="p">}</span><span class="w"> </span><span class="n">something3_t</span><span class="p">;</span>
</pre></div><p>Currently we can use something like<div class="highlight"><pre><span></span><span class="n">SOMETHING</span><span class="p">:</span> <span class="n">Const</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">ANOTHER</span><span class="p">:</span> <span class="n">Const</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div><p>This however make it annoying to maintain, as we now have a copy of the enum value.<p>We can use below as well.<div class="highlight"><pre><span></span><span class="nd">@nativemacro</span><span class="p">(</span><span class="s2">&quot;SOMETHING&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">something</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div><p>This does not copy the value, but make it annoying to use the API as now we need to access this as <code>something()</code>.<h3 id="suggestions">Suggestions</h3><h4 id="suggestion-1">Suggestion 1</h4><div class="highlight"><pre><span></span><span class="c1"># Expose enum value / #define value</span>
<span class="n">nativexp</span> <span class="s2">&quot;SOMETHING&quot;</span> <span class="k">as</span> <span class="n">SOMETHING</span><span class="p">:</span> <span class="n">Const</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>

<span class="c1"># Some simple constant calculations</span>
<span class="n">nativexp</span> <span class="s2">&quot;&quot;&quot;1 + 1&quot;&quot;&quot;</span> <span class="k">as</span> <span class="n">TWO</span><span class="p">:</span> <span class="n">Const</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
</pre></div><ul><li>Pro:</ul><ul><li>Clearly define that this is a native expression</ul><ul><li>Con:</ul><ul><li>Looks different</ul><h4 id="suggestion-2">Suggestion 2</h4><div class="highlight"><pre><span></span><span class="n">TWO</span><span class="p">:</span> <span class="n">Const</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">ccode</span> <span class="s2">&quot;&quot;&quot;1 + 1&quot;&quot;&quot;</span>
</pre></div><ul><li>Pro:</ul><ul><li>Consistent syntax</ul><ul><li>Clearly define that this is a native expression (ccode)</ul><ul><li>Con:</ul><ul><li>None</ul><h4 id="suggestion-3">Suggestion 3</h4><div class="highlight"><pre><span></span><span class="n">TWO</span><span class="p">:</span> <span class="n">Const</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">nativexp</span> <span class="s2">&quot;&quot;&quot;1 + 1&quot;&quot;&quot;</span>
</pre></div><ul><li>Pro:</ul><ul><li>Clearly define that this is a native expression</ul><ul><li>Con:</ul><ul><li>Looks different</ul><h4 id="suggestion-4">Suggestion 4</h4><div class="highlight"><pre><span></span><span class="n">nativexp</span> <span class="s2">&quot;&quot;&quot;1 + 1&quot;&quot;&quot;</span> <span class="o">-&gt;</span> <span class="n">TWO</span><span class="p">:</span> <span class="n">Const</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
</pre></div><ul><li>Pro:</ul><ul><li>None</ul><ul><li>Con:</ul><ul><li>Looks different</ul><h4 id="suggestion-5">Suggestion 5</h4><div class="highlight"><pre><span></span><span class="n">TWO</span><span class="p">:</span> <span class="n">Const</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">nativexp</span> <span class="s2">&quot;&quot;&quot;1 + 1&quot;&quot;&quot;</span>
</pre></div><ul><li>Pro:</ul><ul><li>Consistent syntax</ul><ul><li>Clearly define that this is a native expression (ccode)</ul><ul><li>Con:</ul><ul><li>New keyword is introduced</ul><p>This would compile to<div class="highlight"><pre><span></span><span class="cp">#define yk__TWO (1 + 1)</span>
</pre></div><h3 id="conclusion">Conclusion</h3><p>I'm going with suggestion 2 as it uses already existing keywords and also at the same time looks consistent with current constants.</div><div class="note"></div></div><div class="box"><div class="content"><hr></div><div class="note"><hr></div></div><div class="box"><div class="content"><h2 id="yama-0002-adding-support-for-stack-allocated-structs">YAMA 0002 - Adding support for stack allocated structs</h2><span class="timestamp">Created 2023-07-30, Last Updated 2023-07-30</span><ul><li>Author(s): Bhathiya Perera</ul><ul><li>Status : ✅</ul><h3 id="problem">Problem</h3><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Enemy</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">hit_points</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">enemies</span><span class="p">:</span> <span class="n">Array</span><span class="p">[</span><span class="n">Enemy</span><span class="p">]</span> <span class="o">=</span> <span class="n">arrnew</span><span class="p">(</span><span class="s2">&quot;Enemy&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">enemies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Enemy</span><span class="p">()</span>
    <span class="n">enemies</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Enemy</span><span class="p">()</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div><p>Given a structure like above, it makes no sense to allocate individual objects in heap all the time.<p>We can avoid it by using <code>Tuple</code> however we lose the information about field names then.<p>Keep in mind that the Tuple's in Yaksha are mutable (Mutable <code>Tuple</code>s are what we have at the moment, may or may not change in future).<h3 id="suggestions">Suggestions</h3><h4 id="suggestion-1">Suggestion 1</h4><div class="highlight"><pre><span></span><span class="nd">@namedtuple</span>
<span class="k">class</span> <span class="nc">Enemy</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">hit_points</span><span class="p">:</span> <span class="nb">int</span>
</pre></div><ul><li>Pro:</ul><ul><li>Consistent syntax</ul><ul><li>Does not introduce a new keyword</ul><ul><li>Con:</ul><ul><li>No way to tell that this get allocated in stack?</ul><h4 id="suggestion-2">Suggestion 2</h4><div class="highlight"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Enemy</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">hit_points</span><span class="p">:</span> <span class="nb">int</span>
</pre></div><ul><li>Pro:</ul><ul><li>Consistent syntax</ul><ul><li>Does not introduce a new keyword</ul><ul><li>Familiarity</ul><ul><li>Con:</ul><ul><li>No way to tell that this get allocated in stack?</ul><ul><li>Looks like python but different might make it confusing</ul><h4 id="suggestion-3">Suggestion 3</h4><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Enemy</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">hit_points</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">Enemy</span><span class="p">()</span>     <span class="c1"># &lt;&lt; allocate on stack</span>
<span class="n">new</span> <span class="n">Enemy</span><span class="p">()</span> <span class="c1"># &lt;&lt; allocate on heap</span>
</pre></div><ul><li>Pro:</ul><ul><li>Similar to how C++ works.</ul><ul><li><code>new</code> - <code>del</code> pairing</ul><ul><li>Con:</ul><ul><li>Need to rewrite everything to follow this convention</ul><ul><li>Note⚠️⚠️:</ul><ul><li>Perhaps reconsider this approach at some point</ul><h4 id="suggestion-4">Suggestion 4 ✅</h4><div class="highlight"><pre><span></span><span class="nd">@onstack</span>
<span class="k">class</span> <span class="nc">Enemy</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">hit_points</span><span class="p">:</span> <span class="nb">int</span>
<span class="c1"># Rename @dotaccess to @onstack</span>
<span class="c1"># And use that for this purpose</span>
<span class="n">Enemy</span><span class="p">()</span> <span class="c1"># This is disallowed. Just create a variable and you can use it.</span>
</pre></div><ul><li>Pro:</ul><ul><li>Defines that this is different from a normal class</ul><ul><li>Clearly visible that this get allocated on stack</ul><ul><li>Con:</ul><ul><li>Require changes to how @dotaccess works currently</ul><h3 id="conclusion">Conclusion</h3><p>I am thinking suggestion 4 is the best approach.<h3 id="update">Update</h3><p>Additionally Yaksha now supports <code>struct</code> keyword. That act as a syntax sugar for <code>@onstack class</code>.</div><div class="note"></div></div><div class="box"><div class="content"><hr></div><div class="note"><hr></div></div><div class="box"><div class="content"><h2 id="yama-0003-for-loop-loop">YAMA 0003 - For loop / loop</h2><span class="timestamp">Created 2023-07-30, Last Updated 2023-07-30</span><ul><li>Author(s): Bhathiya Perera</ul><ul><li>Status : ✅</ul><h3 id="problem">Problem</h3><p>Yaksha programming language does not offer a <code>for</code> syntax sugar. This is annoying for someone coming from Python or other languages that has this feature.<p>We have <code>foreach</code> builtin and <code>while</code> loop, which can be used at the moment. <code>for</code> can make certain things easy.<h4 id="use-case-1-for-each-element-in-array">Use case 1 - for each element in array ✅</h4><p>How it works now<div class="highlight"><pre><span></span><span class="n">items</span><span class="p">:</span> <span class="n">Array</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_it</span><span class="p">()</span>

<span class="n">c</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

<span class="k">while</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">items</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">continue</span>
    <span class="n">println</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="n">c</span><span class="p">])</span>
    <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div><p>Syntax sugar (we will keep compulsory data types for now)<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">item</span><span class="p">:</span> <span class="nb">int</span> <span class="ow">in</span> <span class="n">get_it</span><span class="p">():</span> <span class="c1"># get_it should return Array[T]</span>
    <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">println</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</pre></div><p>Desugared<div class="highlight"><pre><span></span><span class="n">yy__1t</span><span class="p">:</span> <span class="n">Array</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_it</span><span class="p">()</span>
<span class="n">yy__2t</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">yy__3t</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">yk__1t</span><span class="p">)</span>

<span class="k">while</span> <span class="n">yy__2t</span> <span class="o">&lt;</span> <span class="n">yy__3t</span><span class="p">:</span>
    <span class="n">ccode</span> <span class="s2">&quot;&quot;&quot;#define yy__item yy__1t[yy__2t]</span><span class="se">\n</span><span class="s2">// desugar begin&quot;&quot;&quot;</span>
    <span class="n">expose_native</span> <span class="n">item</span><span class="p">:</span> <span class="nb">int</span>      <span class="c1"># To expose what we put in above C code</span>
    <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">yy__2t</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">continue</span>                 <span class="c1"># Continue must increase the counter</span>
    <span class="n">println</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">ccode</span> <span class="s2">&quot;&quot;&quot;#undef yy__item</span><span class="se">\n</span><span class="s2">// desugar end&quot;&quot;&quot;</span>
    <span class="n">yy__2t</span> <span class="o">+=</span> <span class="mi">1</span>               <span class="c1"># Increase count at the very end</span>
</pre></div><h4 id="use-case-2-endless-loops">Use case 2 - endless loops ✅</h4><p>Syntax sugar<div class="highlight"><pre><span></span><span class="k">for</span><span class="p">:</span>
    <span class="n">game_step</span><span class="p">()</span>
    <span class="n">log_stuff</span><span class="p">()</span>
</pre></div><p>Desugared<div class="highlight"><pre><span></span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">game_step</span><span class="p">()</span>
    <span class="n">log_stuff</span><span class="p">()</span>
</pre></div><h4 id="use-case-3-custom-iterators-iterables-deferred-at-this-step">Use case 3 - custom iterators / iterables ⚠️(deferred at this step)</h4><p>Syntax sugar<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">next_book</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Books</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Book</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">has_next_book</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Books</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">process</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">books</span><span class="p">:</span> <span class="n">Books</span> <span class="o">=</span> <span class="n">get_it</span><span class="p">()</span>
    <span class="n">it</span><span class="p">:</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Book</span><span class="p">]</span> <span class="o">=</span> <span class="n">iterator</span><span class="p">(</span><span class="s2">&quot;Book&quot;</span><span class="p">,</span> <span class="n">books</span><span class="p">,</span> <span class="n">next_book</span><span class="p">,</span> <span class="n">has_next_book</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">element</span><span class="p">:</span> <span class="n">Book</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
        <span class="n">print_book</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
</pre></div><h4 id="use-case-4-range-for-loops-not-required-a-we-have-c-like-for-loops">Use case 4 - range for loops ⚠️(not required a we have c-like for loops)</h4><p>Syntax sugar<div class="highlight"><pre><span></span><span class="c1"># Example 1</span>
<span class="n">r</span><span class="p">:</span> <span class="n">Range</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># do not print 1</span>
       <span class="k">continue</span>
    <span class="n">println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="c1"># Example 2</span>
<span class="k">for</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># do not print 1</span>
       <span class="k">continue</span>
    <span class="n">println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div><p>Desugared<div class="highlight"><pre><span></span><span class="n">r</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
<span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">hidden__c</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">while</span> <span class="n">hidden__c</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
    <span class="n">i</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">hidden__c</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">hidden__c</span> <span class="o">+=</span> <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">continue</span>
    <span class="n">println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">hidden__c</span> <span class="o">+=</span> <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</pre></div><h3 id="conclusion">Conclusion</h3><p>Iterators/Ranges are deferred for now. It would be better to come up with a generic <code>Iterator</code> approach for these.<p>At the moment I think endless loops and simple for-each style loops should be implemented.</div><div class="note"></div></div><div class="box"><div class="content"><hr></div><div class="note"><hr></div></div><div class="box"><div class="content"><h2 id="yama-0004-iterators">YAMA 0004 - Iterators</h2><span class="timestamp">Created 2023-07-30, Last Updated 2023-07-30</span><ul><li>Author(s): Bhathiya Perera</ul><ul><li>Status : Draft</ul><h3 id="problem">Problem</h3><p>We would like to introduce support for iterators, such that it allows Yaksha to simply iterate arbitrary content.<h4 id="use-case-1-custom-iterators-iterables">Use case 1 - custom iterators / iterables</h4><p>Syntax sugar<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">next_book</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Ptr</span><span class="p">[</span><span class="n">Books</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Book</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">has_next_book</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Ptr</span><span class="p">[</span><span class="n">Books</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">process</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">books</span><span class="p">:</span> <span class="n">Books</span> <span class="o">=</span> <span class="n">get_it</span><span class="p">()</span>
    <span class="c1"># Books is the mutable state that is passed to next_book and has_next_book</span>
    <span class="c1"># Book is the type that is returned from the next_book</span>
    <span class="n">it</span><span class="p">:</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Book</span><span class="p">]</span> <span class="o">=</span> <span class="n">iterator</span><span class="p">(</span><span class="n">books</span><span class="p">,</span> <span class="n">next_book</span><span class="p">,</span> <span class="n">has_next_book</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">element</span><span class="p">:</span> <span class="n">Book</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
        <span class="n">print_book</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
</pre></div><p>Desugared<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">next_book</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Ptr</span><span class="p">[</span><span class="n">Books</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Book</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">has_next_book</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Ptr</span><span class="p">[</span><span class="n">Books</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">process</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">books</span><span class="p">:</span> <span class="n">Books</span> <span class="o">=</span> <span class="n">get_it</span><span class="p">()</span>

    <span class="n">it</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Books</span><span class="p">,</span> <span class="o">..</span><span class="p">,</span> <span class="o">..</span><span class="p">]</span>
    <span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">books</span>
    <span class="n">it</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">next_book</span>
    <span class="n">it</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">has_next_book</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">it</span><span class="p">[</span><span class="mi">1</span><span class="p">])(</span><span class="n">getref</span><span class="p">(</span><span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">element</span><span class="p">:</span> <span class="n">Book</span> <span class="o">=</span> <span class="p">(</span><span class="n">it</span><span class="p">[</span><span class="mi">2</span><span class="p">])(</span><span class="n">getref</span><span class="p">(</span><span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">print_book</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
</pre></div><h4 id="use-case-2-range-for-loops">Use case 2 - range for loops</h4><p>Syntax sugar<div class="highlight"><pre><span></span><span class="c1"># Example 1</span>
<span class="n">r</span><span class="p">:</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># do not print 1</span>
       <span class="k">continue</span>
    <span class="n">println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="c1"># Example 2 (would desugar similarly)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># do not print 1</span>
       <span class="k">continue</span>
    <span class="n">println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div><p>Desugared<div class="highlight"><pre><span></span><span class="n">r</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="o">..</span><span class="p">,</span> <span class="o">..</span><span class="p">]</span>
<span class="n">yy__1t</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
<span class="n">yy__1t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>       <span class="c1"># start</span>
<span class="n">yy__1t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>       <span class="c1"># stop *non inclusive</span>
<span class="n">yy__1t</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>       <span class="c1"># step</span>
<span class="n">yy__1t</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">yy__1t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># current item</span>
<span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">yy__1t</span>
<span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">yk__next_range</span>
<span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">yk__has_range</span>

<span class="k">while</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])(</span><span class="n">getref</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
    <span class="n">i</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">])(</span><span class="n">getref</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div><h3 id="conclusion">Conclusion</h3><p>Iterators make a fine addition to foreach loop.</div><div class="note"></div></div><div class="box"><div class="content"><hr></div><div class="note"><hr></div></div><div class="box"><div class="content"><h2 id="yama-0005-dsl-macros-for-yaksha">YAMA 0005 - DSL macros for Yaksha</h2><span class="timestamp">Created 2023-07-30, Last Updated 2023-07-30</span><ul><li>Author(s): Bhathiya Perera</ul><ul><li>Status : In Progress</ul><h3 id="problem">Problem</h3><p>Macros allow for compile time code generation. Yaksha already supports multiple ways of exposing and defining <code>C</code> macros. However, <code>C</code> macros are not easy to use. Other than for exposing things written in <code>C</code> one should avoid using <code>C</code> macros in Yaksha (<code>@nativexxx</code>).<h3 id="proposal">Proposal</h3><p>YakshaLisp would be a language of it's own. Capable of executing at compile time of Yaksha (and also as a command line interpreter).<h4 id="why">WHY?</h4><ul><li><p>Lisp is a great language for meta programming.<li><p>Lisp can be used to manipulate lists. (List processing 😄)<li><p>Token list to token list transformation is a good fit for lisp.<li><p>Simplest form of syntax to learn.<li><p>Yak-shaving is fun. (Did you see what I did there? 😄)<li><p>Feels nicer and user friendly than <code>C</code> macros and <code>@nativexxx</code> in Yaksha.</ul><h4 id="command-line-interpreter">Command line interpreter</h4><p>Use YakshaLisp as it's own programming language.<ul><li><p><code>yaksha lisp</code> - Run YakshaLisp interpreter REPL (Just YakshaLisp code, no macros!{} required)<li><p><code>yaksha lisp &lt;file&gt;</code> - Execute just YakshaLisp code. (Don't use macros!{} here)</ul><h4 id="dsl-macros">DSL macros</h4><p>DSL macros get a list of tokens and outputs a list of tokens. This allows for more complex logic to be written in YakshaLisp macros.<p>Any DSL macro inside <code>{}</code> will be also expanded.<p>Most nested macro invocation will be expanded first. These macros can call other macros as you call a function and support iteration and recursion. These macros will only be expanded once.<h5 id="builtin-functionality-of-yakshalisp">Builtin functionality of YakshaLisp</h5><ul><li><p>Printing to console ✅<li><p>Reading from console ✅ - Requires <code>enable_print</code> to be called, before calling <code>print</code> and <code>println</code>, console output of <code>yaksha compile</code> maybe altered using this. Therefore, this is disabled by default.<li><p>Reading/writing text files ✅<li><p>Strings, decimal Integers ✅<li><p>List manipulation ✅<li><p>Maps (string -&gt; value only) ✅<li><p>Map literals, and manipulation ✅<li><p>Working with Yaksha tokens ✅<li><p>Iteration ✅<li><p>Conditions - if, cond ✅<li><p>Few functional built ins - map, reduce, range ✅<li><p>Q-Expressions inspired by <a href="http://www.buildyourownlisp.com/">Build Your Own Lisp</a> lisp dialect. ✅ (This is somewhat similar to <code>'(+ 1 2 3)</code>)<li><p>Eval and parse ✅<li><p>Token generation for Yaksha ✅<li><p>Executing commands ❌ (not started, planned) - Will be disabled by default.<li><p>Macros for YakshaLisp ✅<li><p>Imports ✅<li><p>Hygienic macros - gensym ✅ / metagensym 🟡<li><p>Garbage collection ✅</ul><h3 id="item-1-initial-dsl-macro-support">Item 1 - Initial DSL macro support ✅</h3><div class="highlight"><pre><span></span><span class="c1"># ╔═╗┌─┐┌┬┐┌─┐┬┬  ┌─┐  ╔╦╗┬┌┬┐┌─┐</span>
<span class="c1"># ║  │ ││││├─┘││  ├┤    ║ ││││├┤</span>
<span class="c1"># ╚═╝└─┘┴ ┴┴  ┴┴─┘└─┘   ╩ ┴┴ ┴└─┘</span>
<span class="c1"># ╔═╗┬┌─┐┌─┐  ╔╗ ┬ ┬┌─┐┌─┐</span>
<span class="c1"># ╠╣ │┌─┘┌─┘  ╠╩╗│ │┌─┘┌─┘</span>
<span class="c1"># ╚  ┴└─┘└─┘  ╚═╝└─┘└─┘└─┘</span>
<span class="n">macros</span><span class="err">!</span><span class="p">{</span>
    <span class="p">(</span><span class="n">defun</span> <span class="n">to_fb</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">(</span><span class="o">+</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="o">==</span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span> <span class="s2">&quot;&quot;</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">cond</span>
        <span class="p">((</span><span class="o">==</span> <span class="mi">0</span> <span class="p">(</span><span class="n">modulo</span> <span class="n">n</span> <span class="mi">15</span><span class="p">))</span> <span class="s2">&quot;FizzBuzz&quot;</span><span class="p">)</span>
        <span class="p">((</span><span class="o">==</span> <span class="mi">0</span> <span class="p">(</span><span class="n">modulo</span> <span class="n">n</span> <span class="mi">3</span><span class="p">))</span> <span class="s2">&quot;Fizz&quot;</span><span class="p">)</span>
        <span class="p">((</span><span class="o">==</span> <span class="mi">0</span> <span class="p">(</span><span class="n">modulo</span> <span class="n">n</span> <span class="mi">5</span><span class="p">))</span> <span class="s2">&quot;Buzz&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">true</span> <span class="p">(</span><span class="n">to_string</span> <span class="n">n</span><span class="p">))</span>
        <span class="p">)))</span>
    <span class="p">(</span><span class="n">defun</span> <span class="n">fizzbuzz</span> <span class="p">()</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="n">yk_create_token</span> <span class="n">YK_TOKEN_STRING</span> <span class="p">(</span><span class="n">reduce</span> <span class="o">+</span> <span class="p">(</span><span class="nb">map</span> <span class="n">to_fb</span> <span class="p">(</span><span class="nb">range</span> <span class="mi">1</span> <span class="mi">101</span><span class="p">))))))</span>
    <span class="p">(</span><span class="n">yk_register</span> <span class="p">{</span><span class="n">dsl</span> <span class="n">fizzbuzz</span> <span class="n">fizzbuzz</span><span class="p">})</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">println</span><span class="p">(</span><span class="n">fizzbuzz</span><span class="err">!</span><span class="p">{})</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div><h3 id="item-2-hygienic-dsl-macros-using-gensym-and-metagensym">Item 2 - Hygienic DSL macros using <code>gensym</code> ✅ and <code>metagensym</code> 🟡</h3><ul><li><p><code>gensym</code> - This is not a function unlike <code>metagensym</code>, simply return a name such as <code>$a</code> (any valid Yaksha IDENTIFIER prefixed with <code>$</code>) and it will be replaced with a unique symbol. ✅<li><p><code>metagensym</code> - Generates a unique symbol to be used in YakshaLisp code.</ul><h3 id="item-3-macros-for-yakshalisp-via-metamacro">Item 3 - Macros for YakshaLisp via <code>metamacro</code> ✅</h3><p>Did you ever think that your meta programming might benefit from meta-meta programming?<p>Macros get all parameters non-evaluated. The output from macro will be evaluated (in calling scope) and needs to be a list of expressions.<p>Other than that it is similar to a <code>defun</code>. Metamacros are executed similarly to functions and can also call other <code>metamacros</code> or <code>defuns</code>.<p>If you consider just YakshaLisp as it's own language, this allows you to meta program in YakshaLisp during runtime of YakshaLisp.<ul><li><p><code>(is_callable my_meta)</code> --&gt; <code>false</code>, this is <code>true</code> only for <code>builtins</code>, <code>def</code>, <code>lambda</code>.</ul><div class="highlight"><pre><span></span><span class="n">macros</span><span class="err">!</span><span class="p">{</span>
    <span class="p">(</span><span class="n">metamacro</span> <span class="n">twice</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">(</span><span class="o">+</span> <span class="p">(</span><span class="nb">list</span> <span class="n">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="n">x</span><span class="p">)))</span>
    <span class="c1"># since x is an expression (non evaluated), it can be converted to {}</span>
    <span class="c1"># by simply calling list.</span>
    <span class="c1"># x ----&gt; (= value (+ value 1))) # as an expr</span>
    <span class="c1"># (list x) ---&gt; {(= value (+ value 1))}</span>
    <span class="c1"># (+ (list x) (list x)) ---&gt; {</span>
    <span class="c1">#    (= value (+ value 1)) (= value (+ value 1))</span>
    <span class="c1">#    }</span>
    <span class="c1"># now evaluated in calling scope</span>
    <span class="c1"># (eval {...}) --&gt; increase value by 1 twice</span>
    <span class="p">(</span><span class="o">=</span> <span class="n">value</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">(</span><span class="n">twice</span> <span class="p">(</span><span class="o">=</span> <span class="n">value</span> <span class="p">(</span><span class="o">+</span> <span class="n">value</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="c1"># This would set success</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="o">==</span> <span class="n">value</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="o">=</span> <span class="n">success</span> <span class="mi">1</span><span class="p">))</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div><div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">twice</span><span class="w"> </span><span class="p">(</span><span class="nf">println</span><span class="w"> </span><span class="s">&quot;Hello&quot;</span><span class="p">))</span><span class="w"> </span><span class="nv">----&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">eval</span><span class="w"> </span><span class="err">{</span><span class="p">(</span><span class="nf">println</span><span class="w"> </span><span class="s">&quot;Hello&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">println</span><span class="w"> </span><span class="s">&quot;Hello&quot;</span><span class="p">)</span><span class="err">}</span><span class="p">)</span>
</pre></div><h3 id="item-4-import-macros-from-other-files">Item 4 - Import macros from other files ✅</h3><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">libs.macro</span> <span class="k">as</span> <span class="nn">m</span>
<span class="n">macros</span><span class="err">!</span><span class="p">{</span>
    <span class="p">(</span><span class="n">enable_print</span><span class="p">)</span>
    <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">twice</span> <span class="p">(</span><span class="n">println</span> <span class="s2">&quot;Hello&quot;</span><span class="p">))</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div><h3 id="item-5-execute-commands-not-started-planned">Item 5 - Execute commands (not started, planned) ❌</h3><p>Will be disabled by default. Can be enabled by a setting a flag in <code>yaksha.toml</code> or setting an environment variable <code>YAKSHA_SERIOUSLY_ENABLE_SHELL_EXEC</code> to <code>True</code>.<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">libs.macro.shell</span> <span class="k">as</span> <span class="nn">m</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">m</span><span class="o">.</span><span class="n">execute</span><span class="err">!</span><span class="p">{</span><span class="s2">&quot;echo Hello World&quot;</span><span class="p">}</span>
    <span class="n">println</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">readout</span><span class="err">!</span><span class="p">{</span><span class="s2">&quot;echo Hello World&quot;</span><span class="p">,</span> <span class="s2">&quot;Failed&quot;</span><span class="p">})</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div><h3 id="item-6-tracing-macro-expansion-and-debugging-not-started-planned">Item 6 - Tracing macro expansion and debugging (not started, planned) ❌</h3><p>Allow Yaksha compiler to output macro expansion steps. This will be useful for debugging macros.<p>Design TBD.<p>Some tracing features are supported by YakshaLisp if DEBUG is enabled during compilation of Yaksha, but this does not look nice and only useful for Yaksha/YakshaLisp language development. Perhaps these DEBUG features can be made to output more readable output and enable/disable with a flag instead of <code>#ifdef DEBUG</code>.<h3 id="item-7-garbage-collection">Item 7 - Garbage collection ✅</h3><p>YakshaLisp will have a simple mark and sweep garbage collector. This will be used to manage memory allocated by YakshaLisp.</div><div class="note"></div></div><div class="box"><div class="content"><hr></div><div class="note"><hr></div></div><div class="box"><div class="content"><h2 id="yama-0006-c-2-c-compiler-intermediate-c99-to-c99-optimizing-compiler">YAMA 0006 - C 2 C Compiler - Intermediate C99 to C99 optimizing compiler</h2><span class="timestamp">Created 2023-07-30, Last Updated 2023-07-30</span><ul><li>Author(s): Bhathiya Perera</ul><ul><li>Status : Draft</ul><h3 id="problem">Problem</h3><p>Yaksha uses <code>C</code> as a final compilation target. This is to introduce a way to have an intermediate <code>C</code> as a <code>IR</code> that can then be compiled to <code>C</code><h3 id="naming">Naming</h3><ul><li><p>iC99 - Intermediate C 99</ul><h3 id="language">Language</h3><ul><li><p>Looks like C99.<li><p>Loops -&gt; for, while, do while<li><p>structs, constants, unions, #define<li><p>We have built-ins such as <code>yk__sdsnew</code>, etc.</ul><div class="highlight"><pre><span></span><span class="c1">#define yy__raylib_Music Music</span>

<span class="n">i32</span> <span class="n">yy__main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">yy__raylib_Music</span> <span class="n">x</span><span class="p">;</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div><h3 id="architecture">Architecture</h3><ul><li><p>Tokenize<li><p>Level 1 -&gt; no keyword recognition<li><p>Recognizes normal operators, identifiers, #?? and comments<li><p>Discard comments<li><p>Parse all with pre processor statements<li><p>Remove comments<li><p>Apply #defines -&gt; until there are no changes present<li><p>AST based<li><p>Only works with 1 file<li><p>Entry points <code>yy__main</code> <code>yy__game_step</code>, <code>yy__init_state</code></ul><h3 id="optimizations">Optimizations</h3><h4 id="opt-01-apply-all-defines-starting-with-yy">Opt 01 - apply all #defines starting with <code>yy__</code></h4><ul><li><p>Implement a simple pre processor, however only capable of applying #defines that start with <code>yy__</code><li><p>Opt 01.01 - Support non function like macros<li><p>Opt 01.02 - Support for function like macros</ul><h4 id="opt-02-data-types">Opt 02 - data types</h4><ul><li><p>Opt 02.01 - Push down support of integer data types from Yaksha compiler to iC99.<li><p>Instead of having extra complexity at the compiler level for i32, etc like data types, we push it to iC99.</ul><h4 id="opt-03-clean-up">Opt 03 - clean up</h4><ul><li><p>Opt 03.01 - Remove any method that cannot be reached from <code>yy__main()</code><li><p>Opt 03.02 - Remove any operation in same block after <code>return</code></ul><h4 id="opt-04-constant-folding">Opt 04 - constant folding</h4><ul><li><p>Opt 04.01 - Apply <code>-</code><li><p>Opt 04.02 - Remove excess <code>(</code> <code>)</code> parentheses<li><p>Opt 04.03 - Do basic math<li><p>Opt 04.04 - Apply basic string built-ins<li><p>Opt 04.05 - Apply basic array built-ins<li><p>Opt 04.06 - Dead code elimination</ul><h4 id="opt-05-apply-constant-function-calls">Opt 05 - apply constant function calls</h4><ul><li><p>Everything is a constant expression?<li><p>For each function things with simple math, assignments and built ins are considered pure<li><p>Any of these pure functions can be invoked during compile time and folded</ul><h4 id="opt-06-small-function-in-lining">Opt 06 - small function in-lining</h4><ul><li><p>Inline small functions &lt; 20 lines?</ul><h4 id="opt-07-multiple-rounds-of-previous-optimizations">Opt 07 - multiple rounds of previous optimizations</h4><p>while changed:<ul><li><p>Opt 03<li><p>Opt 04<li><p>Opt 05<li><p>Opt 06</ul></div><div class="note"></div></div><div class="box"><div class="content"><hr></div><div class="note"><hr></div></div><div class="box"><div class="content"><h2 id="yama-0007-additional-features-for-structs">YAMA 0007 - Additional features for structs</h2><span class="timestamp">Created 2023-07-30, Last Updated 2023-08-05</span><ul><li>Author(s): Bhathiya Perera</ul><ul><li>Status : In Progress</ul><p>Structures are at the moment can be created as follows<div class="highlight"><pre><span></span><span class="nd">@onstack</span>
<span class="k">class</span> <span class="nc">Banana</span><span class="p">:</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">origin</span><span class="p">:</span> <span class="nb">int</span>

<span class="c1"># Orange is a heap allocated class</span>
<span class="k">class</span> <span class="nc">Orange</span><span class="p">:</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">origin</span><span class="p">:</span> <span class="nb">int</span>
</pre></div><h3 id="item-1-allocate-single-object-on-heap">Item 1 - Allocate single object on heap</h3><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">:</span> <span class="n">Ptr</span><span class="p">[</span><span class="n">Banana</span><span class="p">]</span> <span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="s2">&quot;Banana&quot;</span><span class="p">)</span>

<span class="n">b</span><span class="p">:</span> <span class="n">Orange</span> <span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="s2">&quot;Orange&quot;</span><span class="p">)</span>
</pre></div><h3 id="item-2-create-structures-or-classes">Item 2 - Create structures or classes ✅</h3><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">:</span> <span class="n">Banana</span> <span class="o">=</span> <span class="n">Banana</span> <span class="p">{</span><span class="n">color</span><span class="p">:</span> <span class="n">YELLOW</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n">SRI_LANKA</span><span class="p">}</span>
</pre></div><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">Banana</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">Banana</span><span class="p">){.</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">YELLOW</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">origin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SRI_LANKA</span><span class="p">};</span>
</pre></div><div class="highlight"><pre><span></span><span class="n">b</span><span class="p">:</span> <span class="n">Orange</span> <span class="o">=</span> <span class="n">Orange</span> <span class="p">{</span><span class="n">color</span><span class="p">:</span> <span class="n">ORANGE</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n">SOUTH_AFRICA</span><span class="p">}</span>
</pre></div><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">Orange</span><span class="o">*</span><span class="w"> </span><span class="n">_temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calloc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">Orange</span><span class="p">));</span>
<span class="n">_temp</span><span class="o">-&gt;</span><span class="n">color</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">ORANGE</span><span class="p">;</span>
<span class="n">_temp</span><span class="o">-&gt;</span><span class="n">origin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SOUTH_AFRICA</span><span class="p">;</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Orange</span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_temp</span><span class="p">;</span>
</pre></div><h3 id="item-3-introduce-struct-keyword-desugar-to-onstack-class">Item 3 - Introduce <code>struct</code> keyword, desugar to <code>@onstack class</code> ✅</h3><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">Banana</span><span class="p">:</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">origin</span><span class="p">:</span> <span class="nb">int</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><hr></div><div class="note"><hr></div></div><div class="box"><div class="content"><h2 id="yama-0008-sugar-methods">YAMA 0008 - Sugar methods</h2><span class="timestamp">Created 2023-07-30, Last Updated 2023-07-30</span><ul><li>Author(s): Bhathiya Perera</ul><ul><li>Status : Draft</ul><h3 id="idea-01-arrow">Idea 01 - Arrow</h3><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">Banana</span><span class="p">:</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">origin</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="n">b</span><span class="p">:</span> <span class="n">Ptr</span><span class="p">[</span><span class="n">Banana</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">Banana</span> <span class="o">=</span> <span class="o">...</span>
    <span class="n">b</span><span class="o">-&gt;</span><span class="n">display</span><span class="p">()</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div><h3 id="idea-02-dot">Idea 02 - Dot ✅</h3><div class="highlight"><pre><span></span><span class="nd">@onstack</span>
<span class="k">class</span> <span class="nc">Banana</span><span class="p">:</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">origin</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="n">b</span><span class="p">:</span> <span class="n">Ptr</span><span class="p">[</span><span class="n">Banana</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">Banana</span> <span class="o">=</span> <span class="o">...</span>
    <span class="n">b</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div><p>If <code>@onstack</code> or <code>struct</code> then we need to use <code>Ptr[DataType]</code> otherwise <code>DataType</code> can be used.<p>Going with <code>.</code> as it is already valid AST. Additionally, we can find the method during <code>type checking</code> and desugar it.<div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">getref</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
</pre></div></div><div class="note"></div></div><div class="box"><div class="content"><hr></div><div class="note"><hr></div></div><div class="box"><div class="content"><h2 id="yama-0009-strings-revisited">YAMA 0009 - Strings revisited</h2><span class="timestamp">Created 2023-08-13, Last Updated 2023-08-13</span><ul><li>Author(s): Bhathiya Perera</ul><ul><li>Status : Draft</ul><p>Strings in programming languages are tough to design. You can make things simple by using it like a value type (Copying and deleting it). However, value like strings come at a cost as it does large number of alloc/dealloc resulting in fragmented memory. In WASM4 or embedded (potential future scenario) cases, this kind of alloc/dealloc is not acceptable.<p>This is an all or nothing proposal. Need to support all scenarios explained below. After this is completed, libs/runtime needs to rewritten to use new <code>sr</code> data type instead of <code>str</code> data type.<p>There is also an invisible string data type <code>literal</code> that is only available at compile time (<code>a: literal = "hi"</code> is invalid).<p>This type will be auto-magically converted to <code>sr</code>.<p>This is considered to avoid wasting time doing - runtime concatenation and runtime comparison of <code>literal</code>s.<ul><li><p>Breaking changes** - <code>a = "hello"</code> results in <code>a</code>'s data type to be <code>sr</code> instead of <code>str</code> and <code>sr</code> is now a builtin data type.</ul><h3 id="few-areas-to-explore">Few areas to explore</h3><h4 id="string-reference">String reference</h4><ul><li><p>String reference does not own the underlying heap allocated memory of a string.<li><p>No need to delete or duplicate.<li><p>But it is dangerous to store it in a structure as it might be invalid later on.</ul><h4 id="static-storage-strings">Static storage strings</h4><ul><li><p>Immutable static strings that lives in the static storage, lasts for the whole life time of the program.<li><p>No need to de-allocate.<li><p>Can store as a reference anywhere you like.<li><p>Not copied when passing.</ul><h4 id="string-buffers">String buffers</h4><ul><li><p>Mutable string that owns memory.<li><p>Not copied when passing to a function.<li><p>Can use same underlying <code>yk__sds</code> as data structure.</ul><h4 id="semi-managed-value-like-strings">Semi managed value like strings</h4><ul><li><p>What <code>str</code> represents in Yaksha.<li><p>What is semi-managed? you need to manually de-allocate when a copy is added to a container.</ul><h4 id="string-literals">String literals</h4><ul><li><p>This is a <code>"Hello World"</code> like string literal in Yaksha.<li><p>This is currently automatically converted to <code>str</code>.<li><p>We can consider string literals to be static storage strings.<li><p>Length is known at compile time.</ul><h4 id="library-runtime-use">Library/runtime use</h4><ul><li><p>Runtime functionality will not need to de-allocate strings. Once we switch to use of <code>sr</code> data type.</ul><h3 id="implementation">Implementation</h3><h4 id="underlying-data-structure">Underlying data structure</h4><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">yk__bstr</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Yaksha Base String</span>
<span class="w">    </span><span class="k">union</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">yk__sds</span><span class="w"> </span><span class="n">h</span><span class="p">;</span><span class="w">              </span><span class="c1">// reference to a heap allocated string</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w">         </span><span class="c1">// reference to a statically allocated string</span>
<span class="w">        </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w">                </span><span class="c1">// reference to c.CStr that is heap allocated</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">l</span><span class="p">;</span>
<span class="w">    </span><span class="k">enum</span><span class="w"> </span><span class="n">yk__bstr_type</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">yk__bstr_str</span><span class="p">,</span><span class="w"> </span><span class="n">yk__bstr_static</span><span class="p">,</span><span class="w"> </span><span class="n">yk__bstr_cstr</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<span class="p">};</span>
</pre></div><h4 id="yaksha">Yaksha</h4><p>First we assume we have something like below defined, that takes the new data type <code>sr</code> as an argument.<p><code>literal</code> is a hidden data type -- this cannot be used by end users directly. (Internally represented as <code>:s:</code>)<h5 id="legend">Legend</h5><ul><li><p>✅ - Completed<li><p>N - No allocation should happen here (except in Windows due to need to convert to utf16).<li><p>A - Alloc/Dealloc happens<li><p>C - Compile time<li><p>! - Type-checking / compile error</ul><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">do_something</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="n">sr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="c1"># N</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Printing sr: &quot;</span><span class="p">)</span>      <span class="c1"># N</span>
    <span class="nb">println</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>                  <span class="c1"># N</span>
    <span class="k">return</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">takes_str</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>   <span class="c1"># A (arg is copied here and deleted in the function)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Printing str: &quot;</span><span class="p">)</span>     <span class="c1"># N</span>
    <span class="nb">println</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>                  <span class="c1"># N</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div><h5 id="create-sr-data-type">Create <code>sr</code> data type ✅</h5><ul><li><p>Have it compile to <code>struct yk__bstr</code></ul><h5 id="passing-a-literal-to-sr">Passing a <code>literal</code> to <code>sr</code> ✅</h5><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">do_something</span><span class="p">(</span><span class="s2">&quot;Oi&quot;</span><span class="p">)</span>           <span class="c1"># N</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div><h5 id="passing-an-str-to-sr-and-creating-a-str-with-literal">Passing an <code>str</code> to <code>sr</code> and creating a <code>str</code> with <code>literal</code> ✅</h5><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">s</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Oi&quot;</span>                <span class="c1"># A</span>
    <span class="n">s2</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Ha&quot;</span>               <span class="c1"># A</span>
    <span class="n">do_something</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>              <span class="c1"># N</span>
    <span class="n">do_something</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>             <span class="c1"># N</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div><h5 id="passing-a-literal-sr-to-str">Passing a <code>literal</code>/<code>sr</code> to <code>str</code> ✅</h5><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">do_something</span><span class="p">(</span><span class="s2">&quot;Oi&quot;</span><span class="p">)</span>           <span class="c1"># A</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">sr</span> <span class="o">=</span> <span class="s2">&quot;ha&quot;</span>                 <span class="c1"># A</span>
    <span class="n">takes_str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>                 <span class="c1"># N</span>
    <span class="n">takes_str</span><span class="p">(</span><span class="s2">&quot;Oi oi&quot;</span><span class="p">)</span>           <span class="c1"># N</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div><h5 id="variable-using-sr-as-data-type">Variable using <code>sr</code> as data type ✅</h5><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">oi</span> <span class="o">=</span> <span class="s2">&quot;Oi&quot;</span>                    <span class="c1"># A</span>
    <span class="n">do_something</span><span class="p">(</span><span class="n">oi</span><span class="p">)</span>             <span class="c1"># A</span>
    <span class="n">takes_str</span><span class="p">(</span><span class="s2">&quot;Oi oi&quot;</span><span class="p">)</span>           <span class="c1"># N</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div><h5 id="concatenation-of-str-s-str">Concatenation of <code>str</code>s --&gt; <code>str</code> ✅</h5><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">s</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Oi&quot;</span>                <span class="c1"># N</span>
    <span class="n">s2</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot; Hello&quot;</span>           <span class="c1"># N</span>
    <span class="n">takes_str</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">s2</span><span class="p">)</span>            <span class="c1"># NN</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div><h5 id="concatenation-of-literal-s-literal">Concatenation of <code>literal</code>s --&gt; <code>literal</code> ✅</h5><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">do_something</span><span class="p">(</span><span class="s2">&quot;Oi&quot;</span> <span class="o">+</span> <span class="s2">&quot; Hello there&quot;</span> <span class="o">+</span> <span class="s2">&quot; Another&quot;</span><span class="p">)</span> <span class="c1"># NC</span>
    <span class="n">takes_str</span><span class="p">(</span><span class="s2">&quot;Oi&quot;</span> <span class="o">+</span> <span class="s2">&quot; Hello there&quot;</span> <span class="o">+</span> <span class="s2">&quot; Another&quot;</span><span class="p">)</span>    <span class="c1"># AC</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div><h5 id="concatenation-of-2-or-more-sr-s-str">Concatenation of 2 or more <code>sr</code>s --&gt; <code>str</code> ✅</h5><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>               <span class="c1"># A</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">sr</span> <span class="o">=</span> <span class="s2">&quot;Hi&quot;</span>                 <span class="c1"># A</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">sr</span> <span class="o">=</span> <span class="s2">&quot; there&quot;</span>             <span class="c1"># A</span>
    <span class="n">do_something</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span>      <span class="c1"># NA</span>
    <span class="n">takes_str</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>             <span class="c1"># NN</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div><h5 id="concatenation-of-2-or-more-of-mixed-str-sr-and-literal-s-str">Concatenation of 2 or more of mixed <code>str</code>, <code>sr</code> and <code>literal</code>s --&gt; <code>str</code> ✅</h5><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Hello&quot;</span>             <span class="c1"># N</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">sr</span> <span class="o">=</span> <span class="s2">&quot; World&quot;</span>             <span class="c1"># A</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="s2">&quot; Hehe&quot;</span>          <span class="c1"># NNN</span>
    <span class="n">do_something</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>              <span class="c1"># A</span>
    <span class="n">takes_str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>                 <span class="c1"># N</span>
    <span class="n">d</span> <span class="o">=</span> <span class="s2">&quot;Ha &quot;</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">a</span>      <span class="c1"># NNNN</span>
    <span class="n">takes_str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>                 <span class="c1"># N</span>
    <span class="n">do_something</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>              <span class="c1"># A</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div><h5 id="comparison-of-literal-s-a-a-bool">Comparison of <code>literal</code>s (<code>"a" == "a"</code>) --&gt; <code>bool</code> ✅</h5><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;a&quot;</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>          <span class="c1"># AC</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;a&quot;</span> <span class="o">==</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>          <span class="c1"># AC</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;a&quot;</span> <span class="o">!=</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>          <span class="c1"># AC</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;a&quot;</span> <span class="o">!=</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>          <span class="c1"># AC</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div><h5 id="comparison-of-mixed-str-sr-and-literal-s-bool">Comparison of mixed <code>str</code>, <code>sr</code> and <code>literal</code>s --&gt; <code>bool</code> ✅</h5><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>                 <span class="c1"># N</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">sr</span> <span class="o">=</span> <span class="s2">&quot;oi&quot;</span>                 <span class="c1"># A</span>
    <span class="n">println</span><span class="p">(</span><span class="n">b</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span>              <span class="c1"># A</span>
    <span class="n">println</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span>              <span class="c1"># A</span>
    <span class="n">println</span><span class="p">((</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">))</span><span class="c1"># AA</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;a&quot;</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span>            <span class="c1"># AA</span>
    <span class="n">println</span><span class="p">(</span><span class="n">b</span> <span class="o">!=</span> <span class="n">a</span><span class="p">)</span>              <span class="c1"># AA</span>
    <span class="n">println</span><span class="p">(</span><span class="n">b</span> <span class="o">!=</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>            <span class="c1"># AA</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div><h5 id="wrap-unwrap-c-cstr-const-ptr-const-c-char-as-sr">Wrap/Unwrap <code>c.CStr</code>, <code>Const[Ptr[Const[c.Char]]]</code> as <code>sr</code></h5><ul><li><p>Create a simple wrapper function in libs.c to wrap <code>c.CStr</code> --&gt; <code>getref_cstr</code><li><p>Create a simple wrapper function in libs.c to unwrap <code>c.CStr</code> --&gt; <code>unref_cstr</code><li><p>Create a simple wrapper function in libs.c to wrap <code>Const[Ptr[Const[c.Char]]]</code> --&gt; <code>getref_ccstr</code><li><p>Create a simple wrapper function in libs.c to unwrap <code>Const[Ptr[Const[c.Char]]]</code> --&gt; <code>unref_ccstr</code></ul><h5 id="print-println-will-support-literal-sr-and-str">print/println will support -&gt; <code>literal</code>, <code>sr</code> and <code>str</code>. ✅</h5><ul><li><p>See <code>do_something</code> and <code>take_str</code></ul><h5 id="wrap-array-u8-as-sr">Wrap <code>Array[u8]</code> as <code>sr</code></h5><ul><li><p>Create a simple wrapper function in libs.strings to wrap <code>getref_u8a</code></ul><h5 id="wrap-ptr-u8-as-sr">Wrap <code>Ptr[u8]</code> as <code>sr</code></h5><ul><li><p>Create a simple wrapper function in libs.strings to wrap <code>getref_u8p</code></ul><h5 id="compare-with-none">Compare with None ✅</h5><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">sr</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>                  <span class="c1"># N</span>
    <span class="n">b</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>                 <span class="c1"># A</span>
    <span class="n">println</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span>           <span class="c1"># N</span>
    <span class="n">println</span><span class="p">(</span><span class="n">b</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span>           <span class="c1"># N</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;a&quot;</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">)</span>         <span class="c1"># NC</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;a&quot;</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span>         <span class="c1"># NC</span>
    <span class="n">println</span><span class="p">(</span><span class="kc">None</span> <span class="o">!=</span> <span class="n">a</span><span class="p">)</span>           <span class="c1"># N</span>
    <span class="n">println</span><span class="p">(</span><span class="kc">None</span> <span class="o">!=</span> <span class="n">b</span><span class="p">)</span>           <span class="c1"># N</span>
    <span class="n">println</span><span class="p">(</span><span class="kc">None</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>         <span class="c1"># NC</span>
    <span class="n">println</span><span class="p">(</span><span class="kc">None</span> <span class="o">!=</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>         <span class="c1"># NC</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div><h3 id="additional-tasks">Additional tasks</h3><ul><li><p>Update documentation explaining <code>sr</code> data type.</ul></div><div class="note"></div></div><div class="box"><div class="content"><hr></div><div class="note"><hr></div></div><div class="box"><div class="content"><h2 id="yama-0010-numbers-auto-casting-when-widening">YAMA 0010 - Numbers auto casting when widening</h2><span class="timestamp">Created 2023-08-13, Last Updated 2023-08-13</span><ul><li>Author(s): Bhathiya Perera</ul><ul><li>Status : ✅</ul><p>Following casting is suggested for basic binary mathematical operations.<p>Assignment would follow same casting style, except lhs needs to be wider.<p>Bitwise operations would require manual casting to same data type.<div class="highlight"><pre><span></span>    .-------------.
    |    bool     |
    &#39;.-----------.&#39;
     |          .V-.
     |          |i8|
     |          &#39;.-&#39;
    .V----------.|
    |    u8     ||
    &#39;.---------.&#39;|
    .V-------. | |
    |  u16   | | |
    &#39;.------.&#39; | |
    .V----. |  | |
    | u32 | |  | |
    &#39;.---.&#39; |  | |
    .V--.|  |  | |
    |u64||  |  | |
    &#39;.--&#39;|  |  | |
.---.|   |  |  | |
|f64||   |  |  | |
&#39;^--&#39;|   |  |  | |
.&#39;---V-. |  |  | |
| f32  | |  |  | |
&#39;^-----&#39; |  |  | |
.&#39;-------V-.|  | |
|   i64    ||  | |
&#39;^---------&#39;|  | |
.&#39;----------V-.| |
|     i32     || |
&#39;^------------&#39;| |
.&#39;-------------V-V-.
|       i16        |
&#39;------------------&#39;
</pre></div></div><div class="note"></div></div></div></div><script>!function(){const e=document.querySelector("#btn-toggle");var t=document.querySelector("#btn-small-font"),s=document.querySelector("#btn-medium-font"),n=document.querySelector("#btn-large-font");const a=document.querySelector("#theme-link"),l=document.querySelector("#font-size-link"),o="jadogg.github.io/theme",i="jadogg.github.io/font",c='<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-brightness-high" viewBox="0 0 16 16">\n  <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>\n</svg>',r='<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-moon-fill" viewBox="0 0 16 16">\n  <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>\n</svg>';var m=localStorage.getItem(o),g=localStorage.getItem(i);"/assets/style.min.css"!==m&&"/assets/style.light.min.css"!==m||(a.href=m,e.innerHTML="/assets/style.min.css"===m?c:r),"/assets/large-font.min.css"!=g&&"/assets/medium-font.min.css"!=g&&"/assets/small-font.min.css"!=g||(l.href=g),e.addEventListener("click",function(){"/assets/style.min.css"===a.getAttribute("href")?(a.href="/assets/style.light.min.css",localStorage.setItem(o,"/assets/style.light.min.css"),e.innerHTML=r):(a.href="/assets/style.min.css",localStorage.setItem(o,"/assets/style.min.css"),e.innerHTML=c)}),t.addEventListener("click",function(){l.href="/assets/small-font.min.css",localStorage.setItem(i,"/assets/small-font.min.css")}),s.addEventListener("click",function(){l.href="/assets/medium-font.min.css",localStorage.setItem(i,"/assets/medium-font.min.css")}),n.addEventListener("click",function(){l.href="/assets/large-font.min.css",localStorage.setItem(i,"/assets/large-font.min.css")}),document.body.querySelectorAll("details").forEach(e=>{e.hasAttribute("open")?e.removeAttribute("open"):e.setAttribute("open",!0),console.log(e.hasAttribute("open"))})}()</script>